parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"H5gw":[function(require,module,exports) {

"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CreateBuffer=m,exports.CreateEmptyBuffer=v,exports.FinishRender=g,exports.ReadBuffer=w,exports.Resize=l,exports.Setup=x,exports.StartRender=h,exports.sampler=exports.renderPass=exports.global=exports.format=exports.device=exports.depth=exports.context=exports.clearColor=exports.canvas=exports.cameraBuffer=exports.adapter=void 0;var e=function(e,t,r,o){return new(r||(r=Promise))(function(a,n){function s(e){try{p(o.next(e))}catch(t){n(t)}}function i(e){try{p(o.throw(e))}catch(t){n(t)}}function p(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,i)}p((o=o.apply(e,t||[])).next())})};let t,r;exports.adapter=t,exports.device=r;const o={r:0,g:.1,b:.2,a:1};let a,n,s,i,p,c,u,f,d;function x(o,c){return e(this,void 0,void 0,function*(){if(null!=window.navigator.gpu)return exports.adapter=t=yield window.navigator.gpu.requestAdapter({powerPreference:"high-performance"}),exports.device=r=yield t.requestDevice(),r.lost.then(e=>{console.log(e)}),exports.canvas=s=document.createElement("canvas"),exports.context=i=s.getContext("webgpu"),exports.format=a=i.getPreferredFormat(t),exports.global=p={aspect:void 0},exports.sampler=n=r.createSampler({magFilter:"linear",minFilter:"linear"}),l(o,c),s})}function l(e,t){i.configure({device:r,format:a,size:{width:e,height:t}}),s.width=e,s.height=t,exports.depth=c=r.createTexture({size:{width:s.width,height:s.height},format:"depth32float",usage:GPUTextureUsage.RENDER_ATTACHMENT}),p.aspect=s.width/s.height}function h(e){d=r.createCommandEncoder(),exports.renderPass=f=d.beginRenderPass({colorAttachments:[{loadValue:o,storeOp:"store",view:i.getCurrentTexture().createView()}],depthStencilAttachment:{depthLoadValue:1,depthStoreOp:"store",stencilLoadValue:0,stencilStoreOp:"store",view:c.createView()}}),exports.cameraBuffer=u=e.Buffer()}function g(){f.endPass(),r.queue.submit([d.finish()])}function m(e,t){const o=r.createBuffer({size:e.byteLength,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC|t,mappedAtCreation:!0});return new Uint8Array(o.getMappedRange()).set(new Uint8Array(e.buffer)),o.unmap(),o}function v(e,t){return r.createBuffer({size:e,usage:t,mappedAtCreation:!1})}function w(t,o){return e(this,void 0,void 0,function*(){const e=v(o,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST),a=r.createCommandEncoder();a.copyBufferToBuffer(t,0,e,0,o);const n=a.finish();return r.queue.submit([n]),yield e.mapAsync(GPUMapMode.READ),e.getMappedRange()})}exports.clearColor=o,exports.format=a,exports.sampler=n,exports.canvas=s,exports.context=i,exports.global=p,exports.depth=c,exports.cameraBuffer=u,exports.renderPass=f;
},{}],"khj6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.New=n;var e=r(require("./gpu"));function t(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,n=new WeakMap;return(t=function(e){return e?n:r})(e)}function r(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=t(r);if(n&&n.has(e))return n.get(e);var o={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var f=u?Object.getOwnPropertyDescriptor(e,a):null;f&&(f.get||f.set)?Object.defineProperty(o,a,f):o[a]=e[a]}return o.default=e,n&&n.set(e,o),o}function n(t){return e.device.createShaderModule({code:t})}
},{"./gpu":"H5gw"}],"cBnL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GetServerFile=n,exports.GetUserFile=t;var e=function(e,t,n,o){return new(n||(n=Promise))(function(i,r){function c(e){try{s(o.next(e))}catch(t){r(t)}}function u(e){try{s(o.throw(e))}catch(t){r(t)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,u)}s((o=o.apply(e,t||[])).next())})};function t(t){return e(this,void 0,void 0,function*(){return new Promise((n,o)=>{const i=document.createElement("input");i.type="file",i.accept="";for(let e=0;e<t.length;e++)i.accept+="."+t[e],e<t.length-1&&(i.accept+=",");i.onchange=(()=>e(this,void 0,void 0,function*(){const e=i.files;if(null==e||0==e.length)return;const r=e[0],c=r.name.split("."),u=c[c.length-1];t.includes(u)?n(r):o('format "'+u+'" not supported')})),i.click()})})}function n(t){return e(this,void 0,void 0,function*(){return new Promise((e,n)=>{const o=new XMLHttpRequest;o.onreadystatechange=(()=>{4==o.readyState&&200==o.status&&e(o.responseText)}),o.open("GET",t),o.send(),setTimeout(n,1e3,"file timeout")})})}
},{}],"TmaS":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Render=f;var e=o(require("./gpu")),t=o(require("./module")),r=require("../helper/file");function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}function o(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var f=i?Object.getOwnPropertyDescriptor(e,a):null;f&&(f.get||f.set)?Object.defineProperty(o,a,f):o[a]=e[a]}return o.default=e,r&&r.set(e,o),o}var i=function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{u(n.next(e))}catch(t){i(t)}}function f(e){try{u(n.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,f)}u((n=n.apply(e,t||[])).next())})};let a=void 0;function f(n,o,f,u){return i(this,void 0,void 0,function*(){if(null==a){const n=yield(0,r.GetServerFile)("render/lines.wgsl"),o=t.New(n);a=e.device.createRenderPipeline({vertex:{module:o,entryPoint:"vertexMain",buffers:[{attributes:[{shaderLocation:0,offset:0,format:"float32x3"}],arrayStride:16,stepMode:"vertex"},{attributes:[{shaderLocation:1,offset:0,format:"float32x3"}],arrayStride:16,stepMode:"vertex"}]},fragment:{module:o,entryPoint:"fragmentMain",targets:[{format:e.format}]},depthStencil:{format:"depth32float",depthWriteEnabled:!0,depthCompare:"less"},primitive:{topology:"line-list"}})}const i=new Float32Array(16);n.Save(i,0);const s=e.CreateBuffer(i,GPUBufferUsage.UNIFORM);e.renderPass.setPipeline(a);const c=e.device.createBindGroup({layout:a.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:e.cameraBuffer}},{binding:1,resource:{buffer:s}}]});e.renderPass.setBindGroup(0,c),e.renderPass.setVertexBuffer(0,f),e.renderPass.setVertexBuffer(1,u),e.renderPass.draw(o)})}
},{"./gpu":"H5gw","./module":"khj6","../helper/file":"cBnL"}],"Fngm":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Matrix=void 0;class t{constructor(t){this.data=t}static Identity(){return new t(new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]))}Save(t,a){for(let r=0;r<4;r++)for(let e=0;e<4;e++)t[a+4*r+e]=this.data[r+4*e]}static Translate(a,r,e){return new t(new Float32Array([1,0,0,a,0,1,0,r,0,0,1,e,0,0,0,1]))}static RotateX(a){return new t(new Float32Array([1,0,0,0,0,Math.cos(a),-Math.sin(a),0,0,Math.sin(a),Math.cos(a),0,0,0,0,1]))}static Rotate(a,r){const e=Math.sin(a),s=Math.cos(a),n=1-s;return new t(new Float32Array([r.x*r.x*n+s,r.x*r.y*n-r.z*e,r.x*r.z*n+r.y*e,0,r.y*r.x*n+r.z*e,r.y*r.y*n+s,r.y*r.z*n-r.x*e,0,r.z*r.x*n-r.y*e,r.z*r.y*n+r.x*e,r.z*r.z*n+s,0,0,0,0,1]))}static RotateY(a){return new t(new Float32Array([Math.cos(a),0,Math.sin(a),0,0,1,0,0,-Math.sin(a),0,Math.cos(a),0,0,0,0,1]))}static RotateZ(a){return new t(new Float32Array([Math.cos(a),-Math.sin(a),0,0,Math.sin(a),Math.cos(a),0,0,0,0,1,0,0,0,0,1]))}static Scale(a,r,e){return new t(new Float32Array([a,0,0,0,0,r,0,0,0,0,e,0,0,0,0,1]))}Multiply(a){const r=new Float32Array(16);for(let t=0;t<4;t++)for(let e=0;e<4;e++)for(let s=0;s<4;s++)r[t+4*e]+=this.data[s+4*e]*a.data[t+4*s];return new t(r)}MultiplyVector(t){return{x:this.data[0]*t.x+this.data[1]*t.y+this.data[2]*t.z,y:this.data[4]*t.x+this.data[5]*t.y+this.data[6]*t.z,z:this.data[8]*t.x+this.data[9]*t.y+this.data[10]*t.z}}Position(){return{x:this.data[3],y:this.data[7],z:this.data[11]}}static Perspective(a,r,e,s){const n=(s+e)/(e-s),i=2*s*e/(e-s),o=1/Math.tan(a/2),h=new Float32Array([o/r,0,0,0,0,o,0,0,0,0,n,i,0,0,-1,0]);return new t(h)}}exports.Matrix=t;
},{}],"wYMo":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Position=void 0;var t=require("./math");class i{constructor(){this.model=t.Matrix.Identity()}Save(t,i){this.model.Save(t,i)}Translate(i,l,e){this.model=t.Matrix.Translate(i,l,e).Multiply(this.model)}RotateX(i){this.model=t.Matrix.RotateX(i).Multiply(this.model)}RotateXLocal(i){const l=this.model.Position();this.model=t.Matrix.Translate(l.x,l.y,l.z).Multiply(t.Matrix.RotateX(i)).Multiply(t.Matrix.Translate(-l.x,-l.y,-l.z)).Multiply(this.model)}RotateY(i){this.model=t.Matrix.RotateY(i).Multiply(this.model)}RotateYLocal(i){const l=this.model.Position();this.model=t.Matrix.Translate(l.x,l.y,l.z).Multiply(t.Matrix.RotateY(i)).Multiply(t.Matrix.Translate(-l.x,-l.y,-l.z)).Multiply(this.model)}RotateZ(i){this.model=t.Matrix.RotateZ(i).Multiply(this.model)}RotateZLocal(i){const l=this.model.Position();this.model=t.Matrix.Translate(l.x,l.y,l.z).Multiply(t.Matrix.RotateZ(i)).Multiply(t.Matrix.Translate(-l.x,-l.y,-l.z)).Multiply(this.model)}Scale(i,l,e){this.model=t.Matrix.Scale(i,l,e).Multiply(this.model)}}exports.Position=i;
},{"./math":"Fngm"}],"Nat1":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Camera=void 0;var t=require("./math"),e=r(require("./gpu"));function i(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(i=function(t){return t?r:e})(t)}function r(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var r=i(e);if(r&&r.has(t))return r.get(t);var a={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if("default"!==s&&Object.prototype.hasOwnProperty.call(t,s)){var n=o?Object.getOwnPropertyDescriptor(t,s):null;n&&(n.get||n.set)?Object.defineProperty(a,s,n):a[s]=t[s]}return a.default=t,r&&r.set(t,a),a}class a{constructor(i){this.projection=t.Matrix.Perspective(i,e.global.aspect,.1,1e3),this.view=t.Matrix.Identity(),this.fov=i}set fieldOfView(i){this.fov=i,this.projection=t.Matrix.Perspective(i,e.global.aspect,.1,100)}get fieldOfView(){return this.fov}Buffer(){const t=new Float32Array(32);return this.projection.Save(t,0),this.view.Save(t,16),e.CreateBuffer(t,GPUBufferUsage.UNIFORM)}UpdateSize(){this.projection=t.Matrix.Perspective(this.fov,e.global.aspect,1,1e3)}Translate(e,i,r){this.view=t.Matrix.Translate(-e,-i,-r).Multiply(this.view)}RotateX(e){this.view=t.Matrix.RotateX(-e).Multiply(this.view)}RotateY(e){this.view=t.Matrix.RotateY(-e).Multiply(this.view)}RotateGlobalY(e){const i=this.view.MultiplyVector({x:0,y:1,z:0});this.view=t.Matrix.Rotate(-e,i).Multiply(this.view)}RotateZ(e){this.view=t.Matrix.RotateZ(-e).Multiply(this.view)}}exports.Camera=a;
},{"./math":"Fngm","./gpu":"H5gw"}],"dsRi":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CreateCube=a;var e=t(require("../gpu/gpu"));function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(r=function(e){return e?a:t})(e)}function t(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=r(t);if(a&&a.has(e))return a.get(e);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var f=o?Object.getOwnPropertyDescriptor(e,u):null;f&&(f.get||f.set)?Object.defineProperty(n,u,f):n[u]=e[u]}return n.default=e,a&&a.set(e,n),n}function a(r,t=.001){const a=new Float32Array(4*r);for(let e=0;e<r;e++){switch(Math.floor(6*Math.random())){case 0:a[4*e+0]=2*Math.random()-1,a[4*e+1]=2*Math.random()-1,a[4*e+2]=-1;break;case 1:a[4*e+0]=2*Math.random()-1,a[4*e+1]=2*Math.random()-1,a[4*e+2]=1;break;case 2:a[4*e+0]=2*Math.random()-1,a[4*e+1]=-1,a[4*e+2]=2*Math.random()-1;break;case 3:a[4*e+0]=2*Math.random()-1,a[4*e+1]=1,a[4*e+2]=2*Math.random()-1;break;case 4:a[4*e+0]=-1,a[4*e+1]=2*Math.random()-1,a[4*e+2]=2*Math.random()-1;break;case 5:a[4*e+0]=1,a[4*e+1]=2*Math.random()-1,a[4*e+2]=2*Math.random()-1}a[4*e+0]+=t*Math.random(),a[4*e+1]+=t*Math.random(),a[4*e+2]+=t*Math.random()}return e.CreateBuffer(a,GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE)}
},{"../gpu/gpu":"H5gw"}],"VW9R":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Render=u;var e=a(require("./gpu")),t=a(require("./module")),r=require("../helper/file");function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}function a(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var a={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var f=o?Object.getOwnPropertyDescriptor(e,i):null;f&&(f.get||f.set)?Object.defineProperty(a,i,f):a[i]=e[i]}return a.default=e,r&&r.set(e,a),a}var o=function(e,t,r,n){return new(r||(r=Promise))(function(a,o){function i(e){try{u(n.next(e))}catch(t){o(t)}}function f(e){try{u(n.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,f)}u((n=n.apply(e,t||[])).next())})};let i=void 0,f=void 0;function u(n,a,u,s,d){return o(this,void 0,void 0,function*(){if(null==f||null==i){const n=yield(0,r.GetServerFile)("render/cloud.wgsl"),a=t.New(n);f=e.device.createRenderPipeline({vertex:{module:a,entryPoint:"vertexMain",buffers:[{attributes:[{shaderLocation:0,offset:0,format:"float32x2"}],arrayStride:8,stepMode:"vertex"},{attributes:[{shaderLocation:1,offset:0,format:"float32x3"}],arrayStride:16,stepMode:"instance"},{attributes:[{shaderLocation:2,offset:0,format:"float32x3"}],arrayStride:16,stepMode:"instance"}]},fragment:{module:a,entryPoint:"fragmentMain",targets:[{format:e.format}]},depthStencil:{format:"depth32float",depthWriteEnabled:!0,depthCompare:"less"},primitive:{topology:"triangle-strip",stripIndexFormat:"uint32",cullMode:"back"}}),i=e.CreateBuffer(new Float32Array([-1,-1,1,-1,-1,1,1,1]),GPUBufferUsage.VERTEX)}const o=new Float32Array(18);n.Save(o,0),o[16]=a,o[17]=e.global.aspect;const c=e.CreateBuffer(o,GPUBufferUsage.UNIFORM);e.renderPass.setPipeline(f);const l=e.device.createBindGroup({layout:f.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:e.cameraBuffer}},{binding:1,resource:{buffer:c}}]});e.renderPass.setBindGroup(0,l),e.renderPass.setVertexBuffer(0,i),e.renderPass.setVertexBuffer(1,s),e.renderPass.setVertexBuffer(2,d),e.renderPass.draw(4,u)})}
},{"./gpu":"H5gw","./module":"khj6","../helper/file":"cBnL"}],"jToc":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Compute=a,exports.Render=c;var e=i(require("./gpu")),r=i(require("./module")),t=require("../helper/file");function n(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,t=new WeakMap;return(n=function(e){return e?t:r})(e)}function i(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=n(r);if(t&&t.has(e))return t.get(e);var i={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var f=u?Object.getOwnPropertyDescriptor(e,o):null;f&&(f.get||f.set)?Object.defineProperty(i,o,f):i[o]=e[o]}return i.default=e,t&&t.set(e,i),i}var u=function(e,r,t,n){return new(t||(t=Promise))(function(i,u){function o(e){try{a(n.next(e))}catch(r){u(r)}}function f(e){try{a(n.throw(e))}catch(r){u(r)}}function a(e){var r;e.done?i(e.value):(r=e.value,r instanceof t?r:new t(function(e){e(r)})).then(o,f)}a((n=n.apply(e,r||[])).next())})};let o=void 0,f=void 0;function a(n,i,f){return u(this,void 0,void 0,function*(){null==o&&(o=e.device.createComputePipeline({compute:{module:r.New(yield(0,t.GetServerFile)("compute/kNearest.wgsl")),entryPoint:"main"}}));const u=e.CreateEmptyBuffer(4*f*n,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC),a=new Uint32Array([f,n]),c=e.CreateBuffer(a,GPUBufferUsage.STORAGE),s=e.device.createBindGroup({layout:o.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:c}},{binding:1,resource:{buffer:i}},{binding:3,resource:{buffer:u}}]}),d=e.device.createCommandEncoder(),l=d.beginComputePass({});return l.setPipeline(o),l.setBindGroup(0,s),l.dispatch(Math.ceil(f/256)),l.endPass(),e.device.queue.submit([d.finish()]),u})}function c(n,i,o,a,c,s){return u(this,void 0,void 0,function*(){if(null==f){const n=yield(0,t.GetServerFile)("render/kNearest.wgsl"),i=r.New(n);f=e.device.createRenderPipeline({vertex:{module:i,entryPoint:"vertexMain",buffers:[]},fragment:{module:i,entryPoint:"fragmentMain",targets:[{format:e.format}]},depthStencil:{format:"depth32float",depthWriteEnabled:!0,depthCompare:"less"},primitive:{topology:"line-list"}})}const u=new Float32Array(17);n.Save(u,0),new Uint32Array(u.buffer)[16]=c;const d=e.CreateBuffer(u,GPUBufferUsage.UNIFORM);e.renderPass.setPipeline(f);const l=e.device.createBindGroup({layout:f.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:e.cameraBuffer}},{binding:1,resource:{buffer:d}},{binding:2,resource:{buffer:i}},{binding:3,resource:{buffer:o}},{binding:4,resource:{buffer:a}}]});e.renderPass.setBindGroup(0,l),e.renderPass.draw(s*c*2)})}
},{"./gpu":"H5gw","./module":"khj6","../helper/file":"cBnL"}],"i6k6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Compute=c,exports.K=void 0,exports.Render=s;var e=i(require("./gpu")),r=i(require("./module")),t=require("../helper/file");function n(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,t=new WeakMap;return(n=function(e){return e?t:r})(e)}function i(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=n(r);if(t&&t.has(e))return t.get(e);var i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var f=o?Object.getOwnPropertyDescriptor(e,u):null;f&&(f.get||f.set)?Object.defineProperty(i,u,f):i[u]=e[u]}return i.default=e,t&&t.set(e,i),i}var o=function(e,r,t,n){return new(t||(t=Promise))(function(i,o){function u(e){try{a(n.next(e))}catch(r){o(r)}}function f(e){try{a(n.throw(e))}catch(r){o(r)}}function a(e){var r;e.done?i(e.value):(r=e.value,r instanceof t?r:new t(function(e){e(r)})).then(u,f)}a((n=n.apply(e,r||[])).next())})};let u=void 0,f=void 0;const a=16;function c(n,i){return o(this,void 0,void 0,function*(){null==u&&(u=e.device.createComputePipeline({compute:{module:r.New(yield(0,t.GetServerFile)("compute/triangulate.wgsl")),entryPoint:"main"}}));const o=e.CreateEmptyBuffer(4*i*a,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC),f=e.device.createCommandEncoder(),c=new Uint32Array([i]),s=e.CreateBuffer(c,GPUBufferUsage.STORAGE),d=e.device.createBindGroup({layout:u.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:s}},{binding:1,resource:{buffer:n}},{binding:2,resource:{buffer:o}}]}),l=f.beginComputePass();return l.setPipeline(u),l.setBindGroup(0,d),l.dispatch(Math.ceil(i/256)),l.endPass(),e.device.queue.submit([f.finish()]),o})}function s(n,i,u,a,c,s){return o(this,void 0,void 0,function*(){if(null==f){const n=yield(0,t.GetServerFile)("render/triangle.wgsl"),i=r.New(n);f=e.device.createRenderPipeline({vertex:{module:i,entryPoint:"vertexMain",buffers:[]},fragment:{module:i,entryPoint:"fragmentMain",targets:[{format:e.format}]},depthStencil:{format:"depth32float",depthWriteEnabled:!0,depthCompare:"less"},primitive:{topology:"triangle-list"}})}const o=new Float32Array(17);n.Save(o,0),new Uint32Array(o.buffer)[16]=c;const d=e.CreateBuffer(o,GPUBufferUsage.UNIFORM);e.renderPass.setPipeline(f);const l=e.device.createBindGroup({layout:f.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:e.cameraBuffer}},{binding:1,resource:{buffer:d}},{binding:2,resource:{buffer:i}},{binding:3,resource:{buffer:u}},{binding:4,resource:{buffer:a}}]});e.renderPass.setBindGroup(0,l),e.renderPass.draw(s*c*3)})}exports.K=a;
},{"./gpu":"H5gw","./module":"khj6","../helper/file":"cBnL"}],"FjtV":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Compute=c;var e=i(require("./gpu")),t=i(require("./module")),r=require("../helper/file");function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}function i(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var i={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var c=u?Object.getOwnPropertyDescriptor(e,o):null;c&&(c.get||c.set)?Object.defineProperty(i,o,c):i[o]=e[o]}return i.default=e,r&&r.set(e,i),i}var u=function(e,t,r,n){return new(r||(r=Promise))(function(i,u){function o(e){try{a(n.next(e))}catch(t){u(t)}}function c(e){try{a(n.throw(e))}catch(t){u(t)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,c)}a((n=n.apply(e,t||[])).next())})};let o=void 0;function c(n,i,c){return u(this,void 0,void 0,function*(){null==o&&(o=e.device.createComputePipeline({compute:{module:t.New(yield(0,r.GetServerFile)("compute/filter.wgsl")),entryPoint:"main"}}));const u=new Uint32Array([c,i]),a=e.CreateBuffer(u,GPUBufferUsage.STORAGE),f=e.device.createBindGroup({layout:o.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:a}},{binding:1,resource:{buffer:n}}]}),p=e.device.createCommandEncoder(),l=p.beginComputePass({});l.setPipeline(o),l.setBindGroup(0,f),l.dispatch(Math.ceil(c/256)),l.endPass(),e.device.queue.submit([p.finish()])})}
},{"./gpu":"H5gw","./module":"khj6","../helper/file":"cBnL"}],"cFeU":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Compute=c;var e=i(require("./gpu")),t=i(require("./module")),r=require("../helper/file");function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}function i(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var i={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var c=u?Object.getOwnPropertyDescriptor(e,o):null;c&&(c.get||c.set)?Object.defineProperty(i,o,c):i[o]=e[o]}return i.default=e,r&&r.set(e,i),i}var u=function(e,t,r,n){return new(r||(r=Promise))(function(i,u){function o(e){try{f(n.next(e))}catch(t){u(t)}}function c(e){try{f(n.throw(e))}catch(t){u(t)}}function f(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,c)}f((n=n.apply(e,t||[])).next())})};let o=void 0;function c(n,i,c,f,a){return u(this,void 0,void 0,function*(){null==o&&(o=e.device.createComputePipeline({compute:{module:t.New(yield(0,r.GetServerFile)("compute/edge.wgsl")),entryPoint:"main"}}));const u=new Uint32Array([a,f]),p=e.CreateBuffer(u,GPUBufferUsage.STORAGE),s=e.device.createBindGroup({layout:o.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:p}},{binding:1,resource:{buffer:n}},{binding:2,resource:{buffer:i}},{binding:3,resource:{buffer:c}}]}),d=e.device.createCommandEncoder(),l=d.beginComputePass({});l.setPipeline(o),l.setBindGroup(0,s),l.dispatch(Math.ceil(a/256)),l.endPass(),e.device.queue.submit([d.finish()])})}
},{"./gpu":"H5gw","./module":"khj6","../helper/file":"cBnL"}],"pGyK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Compute=c;var e=i(require("./gpu")),t=i(require("./module")),r=require("../helper/file");function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}function i(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var i={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var c=u?Object.getOwnPropertyDescriptor(e,o):null;c&&(c.get||c.set)?Object.defineProperty(i,o,c):i[o]=e[o]}return i.default=e,r&&r.set(e,i),i}var u=function(e,t,r,n){return new(r||(r=Promise))(function(i,u){function o(e){try{f(n.next(e))}catch(t){u(t)}}function c(e){try{f(n.throw(e))}catch(t){u(t)}}function f(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,c)}f((n=n.apply(e,t||[])).next())})};let o=void 0;function c(n,i,c,f,a){return u(this,void 0,void 0,function*(){null==o&&(o=e.device.createComputePipeline({compute:{module:t.New(yield(0,r.GetServerFile)("compute/edgeOld.wgsl")),entryPoint:"main"}}));const u=new Uint32Array([a,f]),p=e.CreateBuffer(u,GPUBufferUsage.STORAGE),d=e.device.createBindGroup({layout:o.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:p}},{binding:1,resource:{buffer:n}},{binding:2,resource:{buffer:i}},{binding:3,resource:{buffer:c}}]}),l=e.device.createCommandEncoder(),s=l.beginComputePass({});s.setPipeline(o),s.setBindGroup(0,d),s.dispatch(Math.ceil(a/256)),s.endPass(),e.device.queue.submit([l.finish()])})}
},{"./gpu":"H5gw","./module":"khj6","../helper/file":"cBnL"}],"l7rz":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CreateColors=n;var e=t(require("../gpu/gpu"));function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}function t(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=r(t);if(n&&n.has(e))return n.get(e);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var f=a?Object.getOwnPropertyDescriptor(e,u):null;f&&(f.get||f.set)?Object.defineProperty(o,u,f):o[u]=e[u]}return o.default=e,n&&n.set(e,o),o}function n(r){const t=new Float32Array(4*r);for(let e=0;e<r;e++)t[4*e+0]=.3+.7*Math.random(),t[4*e+1]=.3+.7*Math.random(),t[4*e+2]=.3+.7*Math.random();return e.CreateBuffer(t,GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE)}
},{"../gpu/gpu":"H5gw"}],"sU9e":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CreateGrid=n;var e=t(require("../gpu/gpu"));function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}function t(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=r(t);if(n&&n.has(e))return n.get(e);var f={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var y=u?Object.getOwnPropertyDescriptor(e,o):null;y&&(y.get||y.set)?Object.defineProperty(f,o,y):f[o]=e[o]}return f.default=e,n&&n.set(e,f),f}function n(r){const t=new Float32Array(8*(4*r+3)),n=new Float32Array(8*(4*r+3)),f=(e,r,f,u,o)=>{null==o&&(o=u),t[(e*=8)+0]=r.x,t[e+1]=r.y,t[e+2]=r.z,n[e+0]=u.x,n[e+1]=u.y,n[e+2]=u.z,t[e+4]=f.x,t[e+5]=f.y,t[e+6]=f.z,n[e+4]=o.x,n[e+5]=o.y,n[e+6]=o.z};for(let e=-r;e<=r;e++){if(0==e)continue;let t;if(e<0)t=e;else{if(0==e)continue;t=e-1}f(1*r+t,{x:e,y:0,z:r},{x:e,y:0,z:-r},{x:1,y:1,z:1}),f(3*r+t,{x:r,y:0,z:e},{x:-r,y:0,z:e},{x:1,y:1,z:1})}return f(4*r+0,{x:-r,y:0,z:0},{x:r,y:0,z:0},{x:1,y:1,z:1},{x:1,y:0,z:0}),f(4*r+1,{x:0,y:-r,z:0},{x:0,y:r,z:0},{x:1,y:1,z:1},{x:0,y:1,z:0}),f(4*r+2,{x:0,y:0,z:-r},{x:0,y:0,z:r},{x:1,y:1,z:1},{x:0,y:0,z:1}),{length:2*(4*r+3),positions:e.CreateBuffer(t,GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE),colors:e.CreateBuffer(n,GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE)}}
},{"../gpu/gpu":"H5gw"}],"DUqp":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CreateSphere=n;var e=r(require("../gpu/gpu"));function t(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,n=new WeakMap;return(t=function(e){return e?n:r})(e)}function r(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=t(r);if(n&&n.has(e))return n.get(e);var a={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var f=o?Object.getOwnPropertyDescriptor(e,u):null;f&&(f.get||f.set)?Object.defineProperty(a,u,f):a[u]=e[u]}return a.default=e,n&&n.set(e,a),a}function n(t){const r=new Float32Array(4*t);for(let e=0;e<t;e++){const t=Math.acos(2*Math.random()-1),n=2*Math.random()*Math.PI;r[4*e+0]=Math.sin(n)*Math.sin(t),r[4*e+1]=Math.cos(t),r[4*e+2]=Math.cos(n)*Math.sin(t)}return e.CreateBuffer(r,GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE)}
},{"../gpu/gpu":"H5gw"}],"MLh6":[function(require,module,exports) {
"use strict";function r(r,e){const o=r.length,t=new Uint8Array(e);let n=0,i=0;do{let d=r[n++];if(d<32){if(i+ ++d>e)throw new Error("Output buffer is not large enough");if(n+d>o)throw new Error("Invalid compressed data");do{t[i++]=r[n++]}while(--d)}else{let a=d>>5,s=i-((31&d)<<8)-1;if(n>=o)throw new Error("Invalid compressed data");if(7===a&&(a+=r[n++],n>=o))throw new Error("Invalid compressed data");if(s-=r[n++],i+a+2>e)throw new Error("Output buffer is not large enough");if(s<0)throw new Error("Invalid compressed data");if(s>=i)throw new Error("Invalid compressed data");do{t[i++]=t[s++]}while(2+--a)}}while(n<o);return t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.LZF=r;
},{}],"KHL4":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CreatePCD=o;var e=n(require("./decompress")),t=n(require("../gpu/gpu"));function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}function n(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=r(t);if(n&&n.has(e))return n.get(e);var i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var a=o?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(i,s,a):i[s]=e[s]}return i.default=e,n&&n.set(e,i),i}const i=!0;function o(r){const n=s(r);if(null==n)return;const o=n.offset;let a=void 0;void 0!==o.x&&void 0!==o.y&&void 0!==o.z&&(a=new Float32Array(4*n.points));let l=void 0,f=void 0;if(void 0===o.rgb&&void 0===o.rgba||(l=new Float32Array(4*n.points),f=void 0===o.rgb?o.rgba:o.rgb),"ascii"===n.data){const e=new Uint8Array(r);let t="";for(let o=n.headerLen;o<r.byteLength;o++)t+=String.fromCharCode(e[o]);const i=t.split("\n");let s=0;for(let r=0;r<i.length;r++,s+=4){const e=i[r].split(" ");if(void 0!==a&&(a[s+0]=parseFloat(e[o.x]),a[s+1]=parseFloat(e[o.y]),a[s+2]=parseFloat(e[o.z])),void 0!==l){let t=void 0;void 0!==o.rgba?t=new Uint32Array([parseInt(e[o.rgba])]):void 0!==o.rgb&&(t=new Float32Array([parseFloat(e[o.rgb])]));const r=new Uint8Array(t.buffer,0);l[s+2]=r[0]/255,l[s+1]=r[1]/255,l[s+0]=r[2]/255}}}else if("binary"===n.data){let e=0;const t=new DataView(r,n.headerLen);for(let r=0;r<n.points;e+=n.rowSize,r++)void 0!==a&&(a[4*r+0]=t.getFloat32(e+o.x,i),a[4*r+1]=t.getFloat32(e+o.y,i),a[4*r+2]=t.getFloat32(e+o.z,i)),void 0!==l&&(l[4*r+2]=t.getUint8(e+f+0)/255,l[4*r+1]=t.getUint8(e+f+1)/255,l[4*r+0]=t.getUint8(e+f+2)/255)}else if("binary_compressed"===n.data){const t=new Uint32Array(r.slice(n.headerLen,n.headerLen+8)),s=t[0],c=t[1],u=e.LZF(new Uint8Array(r,n.headerLen+8,s),c),p=new DataView(u.buffer);for(let e=0;e<n.points;e++)void 0!==a&&(a[4*e+0]=p.getFloat32(o.x+4*e,i),a[4*e+1]=p.getFloat32(o.y+4*e,i),a[4*e+2]=p.getFloat32(o.z+4*e,i)),void 0!==l&&(l[4*e+2]=p.getUint8(f+4*e+0)/255,l[4*e+1]=p.getUint8(f+4*e+1)/255,l[4*e+0]=p.getUint8(f+4*e+2)/255)}return null!=a?[t.CreateBuffer(a,GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE),n.points]:void 0}function s(e){let t="";const r=new Uint8Array(e);let n=0;const i=r.length;for(;n<i&&-1===t.search(/[\r\n]DATA\s(\S*)\s/i);)t+=String.fromCharCode(r[n++]);const o=t.search(/[\r\n]DATA\s(\S*)\s/i),s=/[\r\n]DATA\s(\S*)\s/i.exec(t.substr(o-1));if(null==o||null==s)return null;const a={};a.data=s[1],a.headerLen=s[0].length+o,a.str=t.substr(0,a.headerLen),a.str=a.str.replace(/#.*/gi,"");const l=/VERSION (.*)/i.exec(a.str);null!==l&&(a.version=parseFloat(l[1]));const f=/FIELDS (.*)/i.exec(a.str);null!==f&&(a.fields=f[1].split(" "));const c=/SIZE (.*)/i.exec(a.str);null!==c&&(a.size=c[1].split(" ").map(function(e){return parseInt(e,10)}));const u=/TYPE (.*)/i.exec(a.str);null!==u&&(a.type=u[1].split(" "));const p=/COUNT (.*)/i.exec(a.str);null!==p&&(a.count=p[1].split(" ").map(function(e){return parseInt(e,10)}));const d=/WIDTH (.*)/i.exec(a.str);null!==d&&(a.width=parseInt(d[1]));const g=/HEIGHT (.*)/i.exec(a.str);null!==g&&(a.height=parseInt(g[1]));const y=/VIEWPOINT (.*)/i.exec(a.str);null!==y&&(a.viewpoint=y[1]);const v=/POINTS (.*)/i.exec(a.str);if(null!==v&&(a.points=parseInt(v[1],10)),null===a.points&&(a.points=a.width*a.height),null==a.count)for(a.count=[],n=0;n<a.fields.length;n++)a.count.push(1);a.offset={};let h=0;for(let b=0;b<a.fields.length;b++)"ascii"===a.data?a.offset[a.fields[b]]=b:"binary"===a.data?(a.offset[a.fields[b]]=h,h+=a.size[b]):"binary_compressed"===a.data&&(a.offset[a.fields[b]]=h,h+=a.size[b]*a.points);return a.rowSize=h,a}
},{"./decompress":"MLh6","../gpu/gpu":"H5gw"}],"ZCfc":[function(require,module,exports) {
"use strict";var e=h(require("./gpu/gpu")),t=h(require("./gpu/lines")),n=require("./gpu/position"),r=require("./gpu/camera"),o=require("./loader/cube"),i=h(require("./gpu/cloud")),a=h(require("./gpu/kNearest")),l=h(require("./gpu/triangulate")),c=h(require("./gpu/filter")),u=h(require("./gpu/edge")),s=h(require("./gpu/edgeOld")),d=require("./loader/color"),p=require("./loader/grid"),f=require("./loader/sphere"),m=require("./loader/pcd");function y(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(y=function(e){return e?n:t})(e)}function h(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=y(t);if(n&&n.has(e))return n.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var a=o?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(r,i,a):r[i]=e[i]}return r.default=e,n&&n.set(e,r),r}var g=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(t){i(t)}}function l(e){try{c(r.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,l)}c((r=r.apply(e,t||[])).next())})};function b(...e){const t=document.createElement("div");let n="";for(let r=0;r<e.length;r++)n+=e[r]+"\n";t.textContent=n,t.className="hint",document.body.append(t),setTimeout(()=>{t.remove()},5e3)}function v(e){const t=prompt(e);if(null==t)return;const n=parseInt(t);return isNaN(n)?void 0:n}document.body.onload=(()=>g(void 0,void 0,void 0,function*(){const y=document.getElementById("display"),h=yield e.Setup(y.clientWidth,y.clientHeight);if(null==h){y.remove();const e=document.createElement("div");e.className="error";const t=document.createElement("div");t.className="large",t.innerHTML="WebGPU not available",e.append(t);const n=document.createElement("div");return n.className="normal",n.innerHTML='Only tested with <a href="https://www.google.com/chrome">Google Chrome</a>',e.append(n),void document.body.append(e)}y.append(h);const w=new r.Camera(Math.PI/4);w.Translate(0,5,30);const C=new n.Position;C.Scale(5,5,5);const k=new n.Position;let q=64,P=q,M=5e4,D=M,K="sphere",O=(0,f.CreateSphere)(M),R=(0,d.CreateColors)(M);const S=(0,p.CreateGrid)(10);y.onwheel=(e=>{const t=1+e.deltaY/1e3;if(0==e.ctrlKey)C.Scale(t,t,t);else{let e=w.fieldOfView*t;e<Math.PI/10&&(e=Math.PI/10),e>9*Math.PI/10&&(e=9*Math.PI/10),w.fieldOfView=e}e.preventDefault(),e.stopImmediatePropagation()}),document.body.onresize=(()=>{e.Resize(y.clientWidth,y.clientHeight),w.UpdateSize()});const I={};let W,N=void 0;document.body.onkeydown=(e=>g(void 0,void 0,void 0,function*(){switch(I[e.code]=!0,e.code){case"KeyH":b("Left mouse button: rotate camera","Mouse wheel: change cloud size","Mouse wheel + Control: change field of view","QWER: move camera","1: change cloud form","1 + Control: change cloud size for sphere and cube","2: compute k nearest points","2 + Control: change k","3: compute triangulation","4: approximate normal (best with triangulation)","4 + Control: approximate normal (best with k-nearest)","Space: render connections with polygons","0: open notes (german)");break;case"Digit1":if(e.ctrlKey){const e=v("input new cloud size");if(null==e)break;D=e,K="test"}switch(O.destroy(),R.destroy(),K){case"sphere":M=D,O=(0,o.CreateCube)(M),K="cube";break;case"cube":{const e=yield fetch("../src/loader/pcd/bunny.pcd"),t=yield(yield e.blob()).arrayBuffer(),n=(0,m.CreatePCD)(t);null!=n?[O,M]=n:alert("pcd error"),K="bunny";break}case"bunny":{const e=yield fetch("../src/loader/pcd/rops_cloud.pcd"),t=yield(yield e.blob()).arrayBuffer(),n=(0,m.CreatePCD)(t);null!=n?[O,M]=n:alert("pcd error"),K="test";break}case"test":M=D,O=(0,f.CreateSphere)(M),K="sphere"}R=(0,d.CreateColors)(M),null!=N&&(N.destroy(),N=void 0);break;case"Digit2":if(e.ctrlKey){const e=v("input new k for nearest points");null!=e&&(P=e)}null!=N&&N.destroy(),q=P,N=yield a.Compute(q,O,M);break;case"Digit3":null!=N&&N.destroy(),N=yield l.Compute(O,M),q=l.K;break;case"Digit4":if(null==N){alert("please calculate the connections first");break}0==e.ctrlKey?yield u.Compute(O,N,R,q,M):yield s.Compute(O,N,R,q,M);break;case"Digit5":if(null==N){alert("please calculate the connections first");break}yield c.Compute(N,q,M);break;case"Digit0":window.open("notes.html","_blank")}})),document.body.onkeyup=(e=>{delete I[e.code]}),b("press 'H' for help"),y.onmousemove=(e=>{0!=(1&e.buttons)&&(w.RotateX(-e.movementY/200),w.RotateGlobalY(-e.movementX/200))}),requestAnimationFrame(e=>{W=e}),requestAnimationFrame(function n(r){return g(this,void 0,void 0,function*(){const o=r-W;o>25&&console.log(o);const c=o/50,u=(e,t,n,r)=>{null!=I[e]&&w.Translate(t*c,n*c,r*c)};u("KeyW",0,0,-1),u("KeyD",1,0,0),u("KeyS",0,0,1),u("KeyA",-1,0,0),u("KeyF",0,-1,0),u("KeyR",0,1,0),e.StartRender(w),yield t.Render(k,S.length,S.positions,S.colors),null!=N?null==I.Space?(yield i.Render(C,.015,M,O,R),yield a.Render(C,O,R,N,q,M)):yield l.Render(C,O,R,N,q,M):yield i.Render(C,.015,M,O,R),e.FinishRender(),W=r,requestAnimationFrame(n)})})}));
},{"./gpu/gpu":"H5gw","./gpu/lines":"TmaS","./gpu/position":"wYMo","./gpu/camera":"Nat1","./loader/cube":"dsRi","./gpu/cloud":"VW9R","./gpu/kNearest":"jToc","./gpu/triangulate":"i6k6","./gpu/filter":"FjtV","./gpu/edge":"cFeU","./gpu/edgeOld":"pGyK","./loader/color":"l7rz","./loader/grid":"sU9e","./loader/sphere":"DUqp","./loader/pcd":"KHL4"}]},{},["ZCfc"], null)
//# sourceMappingURL=main.94eca89d.js.map