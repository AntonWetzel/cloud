parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"H5gw":[function(require,module,exports) {
"use strict";let e,t;Object.defineProperty(exports,"__esModule",{value:!0}),exports.CreateBuffer=x,exports.CreateEmptyBuffer=m,exports.FinishRender=h,exports.ReadBuffer=l,exports.Resize=d,exports.Setup=c,exports.StartRender=g,exports.aspect=p,exports.renderPass=exports.format=exports.device=exports.clearColor=exports.cameraBuffer=void 0,exports.device=t;const r={r:0,g:.1,b:.2,a:1};let a,o,s,n,i,u,f;function p(){return o.width/o.height}async function c(r,n){if(null!=window.navigator.gpu)return e=await window.navigator.gpu.requestAdapter({powerPreference:"high-performance"}),exports.device=t=await e.requestDevice(),o=document.createElement("canvas"),s=o.getContext("webgpu"),exports.format=a=s.getPreferredFormat(e),d(r,n),o}function d(e,r){s.configure({device:t,format:a,size:{width:e,height:r}}),o.width=e,o.height=r,n=t.createTexture({size:{width:o.width,height:o.height},format:"depth32float",usage:GPUTextureUsage.RENDER_ATTACHMENT})}function g(e){f=t.createCommandEncoder(),exports.renderPass=u=f.beginRenderPass({colorAttachments:[{loadValue:r,storeOp:"store",view:s.getCurrentTexture().createView()}],depthStencilAttachment:{depthLoadValue:1,depthStoreOp:"store",stencilLoadValue:0,stencilStoreOp:"store",view:n.createView()}}),exports.cameraBuffer=i=e.Buffer()}function h(){u.endPass(),t.queue.submit([f.finish()])}function x(e,r){const a=t.createBuffer({size:e.byteLength,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC|r,mappedAtCreation:!0});return new Uint8Array(a.getMappedRange()).set(new Uint8Array(e.buffer)),a.unmap(),a}function m(e,r){return t.createBuffer({size:e,usage:r,mappedAtCreation:!1})}async function l(e,r){const a=m(r,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST),o=t.createCommandEncoder();o.copyBufferToBuffer(e,0,a,0,r);const s=o.finish();return t.queue.submit([s]),await a.mapAsync(GPUMapMode.READ),a.getMappedRange()}exports.clearColor=r,exports.format=a,exports.cameraBuffer=i,exports.renderPass=u;
},{}],"khj6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.New=n;var e=r(require("./gpu"));function t(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,n=new WeakMap;return(t=function(e){return e?n:r})(e)}function r(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=t(r);if(n&&n.has(e))return n.get(e);var o={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var f=u?Object.getOwnPropertyDescriptor(e,a):null;f&&(f.get||f.set)?Object.defineProperty(o,a,f):o[a]=e[a]}return o.default=e,n&&n.set(e,o),o}function n(t){return e.device.createShaderModule({code:t})}
},{"./gpu":"H5gw"}],"TmaS":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Render=o;var e=n(require("./gpu")),t=n(require("./module"));function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}function n(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=r(t);if(n&&n.has(e))return n.get(e);var a={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var f=o?Object.getOwnPropertyDescriptor(e,i):null;f&&(f.get||f.set)?Object.defineProperty(a,i,f):a[i]=e[i]}return a.default=e,n&&n.set(e,a),a}let a=void 0;async function o(r,n,o,i){if(null==a){const r=await(await fetch("render/lines.wgsl")).text(),n=t.New(r);a=e.device.createRenderPipeline({vertex:{module:n,entryPoint:"vertexMain",buffers:[{attributes:[{shaderLocation:0,offset:0,format:"float32x3"}],arrayStride:16,stepMode:"vertex"},{attributes:[{shaderLocation:1,offset:0,format:"float32x3"}],arrayStride:16,stepMode:"vertex"}]},fragment:{module:n,entryPoint:"fragmentMain",targets:[{format:e.format}]},depthStencil:{format:"depth32float",depthWriteEnabled:!0,depthCompare:"less"},primitive:{topology:"line-list"}})}const f=new Float32Array(16);r.Save(f,0);const s=e.CreateBuffer(f,GPUBufferUsage.UNIFORM);e.renderPass.setPipeline(a);const u=e.device.createBindGroup({layout:a.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:e.cameraBuffer}},{binding:1,resource:{buffer:s}}]});e.renderPass.setBindGroup(0,u),e.renderPass.setVertexBuffer(0,o),e.renderPass.setVertexBuffer(1,i),e.renderPass.draw(n)}
},{"./gpu":"H5gw","./module":"khj6"}],"Fngm":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Matrix=void 0;class t{constructor(t){this.data=t}static Identity(){return new t(new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]))}Save(t,a){for(let r=0;r<4;r++)for(let e=0;e<4;e++)t[a+4*r+e]=this.data[r+4*e]}static Translate(a,r,e){return new t(new Float32Array([1,0,0,a,0,1,0,r,0,0,1,e,0,0,0,1]))}static RotateX(a){return new t(new Float32Array([1,0,0,0,0,Math.cos(a),-Math.sin(a),0,0,Math.sin(a),Math.cos(a),0,0,0,0,1]))}static Rotate(a,r){const e=Math.sin(a),s=Math.cos(a),n=1-s;return new t(new Float32Array([r.x*r.x*n+s,r.x*r.y*n-r.z*e,r.x*r.z*n+r.y*e,0,r.y*r.x*n+r.z*e,r.y*r.y*n+s,r.y*r.z*n-r.x*e,0,r.z*r.x*n-r.y*e,r.z*r.y*n+r.x*e,r.z*r.z*n+s,0,0,0,0,1]))}static RotateY(a){return new t(new Float32Array([Math.cos(a),0,Math.sin(a),0,0,1,0,0,-Math.sin(a),0,Math.cos(a),0,0,0,0,1]))}static RotateZ(a){return new t(new Float32Array([Math.cos(a),-Math.sin(a),0,0,Math.sin(a),Math.cos(a),0,0,0,0,1,0,0,0,0,1]))}static Scale(a,r,e){return new t(new Float32Array([a,0,0,0,0,r,0,0,0,0,e,0,0,0,0,1]))}Multiply(a){const r=new Float32Array(16);for(let t=0;t<4;t++)for(let e=0;e<4;e++)for(let s=0;s<4;s++)r[t+4*e]+=this.data[s+4*e]*a.data[t+4*s];return new t(r)}MultiplyVector(t){return{x:this.data[0]*t.x+this.data[1]*t.y+this.data[2]*t.z,y:this.data[4]*t.x+this.data[5]*t.y+this.data[6]*t.z,z:this.data[8]*t.x+this.data[9]*t.y+this.data[10]*t.z}}Position(){return{x:this.data[3],y:this.data[7],z:this.data[11]}}static Perspective(a,r,e,s){const n=(s+e)/(e-s),i=2*s*e/(e-s),o=1/Math.tan(a/2),h=new Float32Array([o/r,0,0,0,0,o,0,0,0,0,n,i,0,0,-1,0]);return new t(h)}}exports.Matrix=t;
},{}],"wYMo":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Position=void 0;var t=require("./math");class i{constructor(){this.model=t.Matrix.Identity()}Save(t,i){this.model.Save(t,i)}Translate(i,l,e){this.model=t.Matrix.Translate(i,l,e).Multiply(this.model)}RotateX(i){this.model=t.Matrix.RotateX(i).Multiply(this.model)}RotateXLocal(i){const l=this.model.Position();this.model=t.Matrix.Translate(l.x,l.y,l.z).Multiply(t.Matrix.RotateX(i)).Multiply(t.Matrix.Translate(-l.x,-l.y,-l.z)).Multiply(this.model)}RotateY(i){this.model=t.Matrix.RotateY(i).Multiply(this.model)}RotateYLocal(i){const l=this.model.Position();this.model=t.Matrix.Translate(l.x,l.y,l.z).Multiply(t.Matrix.RotateY(i)).Multiply(t.Matrix.Translate(-l.x,-l.y,-l.z)).Multiply(this.model)}RotateZ(i){this.model=t.Matrix.RotateZ(i).Multiply(this.model)}RotateZLocal(i){const l=this.model.Position();this.model=t.Matrix.Translate(l.x,l.y,l.z).Multiply(t.Matrix.RotateZ(i)).Multiply(t.Matrix.Translate(-l.x,-l.y,-l.z)).Multiply(this.model)}Scale(i,l,e){this.model=t.Matrix.Scale(i,l,e).Multiply(this.model)}}exports.Position=i;
},{"./math":"Fngm"}],"Nat1":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Camera=void 0;var t=r(require("./gpu")),e=require("./math");function i(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(i=function(t){return t?r:e})(t)}function r(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var r=i(e);if(r&&r.has(t))return r.get(t);var a={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if("default"!==s&&Object.prototype.hasOwnProperty.call(t,s)){var n=o?Object.getOwnPropertyDescriptor(t,s):null;n&&(n.get||n.set)?Object.defineProperty(a,s,n):a[s]=t[s]}return a.default=t,r&&r.set(t,a),a}class a{constructor(i){this.projection=e.Matrix.Perspective(i,t.aspect(),.1,1e3),this.view=e.Matrix.Identity(),this.fov=i}set fieldOfView(i){this.fov=i,this.projection=e.Matrix.Perspective(i,t.aspect(),.1,100)}get fieldOfView(){return this.fov}Buffer(){const e=new Float32Array(32);return this.projection.Save(e,0),this.view.Save(e,16),t.CreateBuffer(e,GPUBufferUsage.UNIFORM)}UpdateSize(){this.projection=e.Matrix.Perspective(this.fov,t.aspect(),1,1e3)}Translate(t,i,r){this.view=e.Matrix.Translate(-t,-i,-r).Multiply(this.view)}RotateX(t){this.view=e.Matrix.RotateX(-t).Multiply(this.view)}RotateY(t){this.view=e.Matrix.RotateY(-t).Multiply(this.view)}RotateGlobalY(t){const i=this.view.MultiplyVector({x:0,y:1,z:0});this.view=e.Matrix.Rotate(-t,i).Multiply(this.view)}RotateZ(t){this.view=e.Matrix.RotateZ(-t).Multiply(this.view)}}exports.Camera=a;
},{"./gpu":"H5gw","./math":"Fngm"}],"dsRi":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CreateCube=a;var e=t(require("../gpu/gpu"));function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(r=function(e){return e?a:t})(e)}function t(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=r(t);if(a&&a.has(e))return a.get(e);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var f=o?Object.getOwnPropertyDescriptor(e,u):null;f&&(f.get||f.set)?Object.defineProperty(n,u,f):n[u]=e[u]}return n.default=e,a&&a.set(e,n),n}function a(r,t=.001){const a=new Float32Array(4*r);for(let e=0;e<r;e++){switch(Math.floor(6*Math.random())){case 0:a[4*e+0]=2*Math.random()-1,a[4*e+1]=2*Math.random()-1,a[4*e+2]=-1;break;case 1:a[4*e+0]=2*Math.random()-1,a[4*e+1]=2*Math.random()-1,a[4*e+2]=1;break;case 2:a[4*e+0]=2*Math.random()-1,a[4*e+1]=-1,a[4*e+2]=2*Math.random()-1;break;case 3:a[4*e+0]=2*Math.random()-1,a[4*e+1]=1,a[4*e+2]=2*Math.random()-1;break;case 4:a[4*e+0]=-1,a[4*e+1]=2*Math.random()-1,a[4*e+2]=2*Math.random()-1;break;case 5:a[4*e+0]=1,a[4*e+1]=2*Math.random()-1,a[4*e+2]=2*Math.random()-1}a[4*e+0]+=t*Math.random(),a[4*e+1]+=t*Math.random(),a[4*e+2]+=t*Math.random()}return e.CreateBuffer(a,GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE)}
},{"../gpu/gpu":"H5gw"}],"VW9R":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Render=f;var e=a(require("./gpu")),t=a(require("./module"));function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(r=function(e){return e?a:t})(e)}function a(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=r(t);if(a&&a.has(e))return a.get(e);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in e)if("default"!==f&&Object.prototype.hasOwnProperty.call(e,f)){var i=o?Object.getOwnPropertyDescriptor(e,f):null;i&&(i.get||i.set)?Object.defineProperty(n,f,i):n[f]=e[f]}return n.default=e,a&&a.set(e,n),n}let n=void 0,o=void 0;async function f(r,a,f,i,s){if(null==o||null==n){const r=await(await fetch("render/cloud.wgsl")).text(),a=t.New(r);o=e.device.createRenderPipeline({vertex:{module:a,entryPoint:"vertexMain",buffers:[{attributes:[{shaderLocation:0,offset:0,format:"float32x2"}],arrayStride:8,stepMode:"vertex"},{attributes:[{shaderLocation:1,offset:0,format:"float32x3"}],arrayStride:16,stepMode:"instance"},{attributes:[{shaderLocation:2,offset:0,format:"float32x3"}],arrayStride:16,stepMode:"instance"}]},fragment:{module:a,entryPoint:"fragmentMain",targets:[{format:e.format}]},depthStencil:{format:"depth32float",depthWriteEnabled:!0,depthCompare:"less"},primitive:{topology:"triangle-strip",stripIndexFormat:"uint32",cullMode:"back"}}),n=e.CreateBuffer(new Float32Array([-1,-1,1,-1,-1,1,1,1]),GPUBufferUsage.VERTEX)}const u=new Float32Array(18);r.Save(u,0),u[16]=a,u[17]=e.aspect();const d=e.CreateBuffer(u,GPUBufferUsage.UNIFORM);e.renderPass.setPipeline(o);const c=e.device.createBindGroup({layout:o.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:e.cameraBuffer}},{binding:1,resource:{buffer:d}}]});e.renderPass.setBindGroup(0,c),e.renderPass.setVertexBuffer(0,n),e.renderPass.setVertexBuffer(1,i),e.renderPass.setVertexBuffer(2,s),e.renderPass.draw(4,f)}
},{"./gpu":"H5gw","./module":"khj6"}],"jToc":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Compute=a,exports.Render=o;var e=n(require("./gpu")),r=n(require("./module"));function t(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,n=new WeakMap;return(t=function(e){return e?n:r})(e)}function n(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=t(r);if(n&&n.has(e))return n.get(e);var i={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=u?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(i,a,o):i[a]=e[a]}return i.default=e,n&&n.set(e,i),i}let i=void 0,u=void 0;async function a(t,n,u){null==i&&(i=e.device.createComputePipeline({compute:{module:r.New(await(await fetch("compute/kNearest.wgsl")).text()),entryPoint:"main"}}));const a=e.CreateEmptyBuffer(4*u*t,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC),o=new Uint32Array([u,t]),f=e.CreateBuffer(o,GPUBufferUsage.STORAGE),s=e.device.createBindGroup({layout:i.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:f}},{binding:1,resource:{buffer:n}},{binding:3,resource:{buffer:a}}]}),c=e.device.createCommandEncoder(),d=c.beginComputePass({});return d.setPipeline(i),d.setBindGroup(0,s),d.dispatch(Math.ceil(u/256)),d.endPass(),e.device.queue.submit([c.finish()]),a}async function o(t,n,i,a,o,f){if(null==u){const t=await(await fetch("render/kNearest.wgsl")).text(),n=r.New(t);u=e.device.createRenderPipeline({vertex:{module:n,entryPoint:"vertexMain",buffers:[]},fragment:{module:n,entryPoint:"fragmentMain",targets:[{format:e.format}]},depthStencil:{format:"depth32float",depthWriteEnabled:!0,depthCompare:"less"},primitive:{topology:"line-list"}})}const s=new Float32Array(17);t.Save(s,0),new Uint32Array(s.buffer)[16]=o;const c=e.CreateBuffer(s,GPUBufferUsage.UNIFORM);e.renderPass.setPipeline(u);const d=e.device.createBindGroup({layout:u.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:e.cameraBuffer}},{binding:1,resource:{buffer:c}},{binding:2,resource:{buffer:n}},{binding:3,resource:{buffer:i}},{binding:4,resource:{buffer:a}}]});e.renderPass.setBindGroup(0,d),e.renderPass.draw(f*o*2)}
},{"./gpu":"H5gw","./module":"khj6"}],"i6k6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Compute=a,exports.K=void 0,exports.Render=f;var e=n(require("./gpu")),r=n(require("./module"));function t(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,n=new WeakMap;return(t=function(e){return e?n:r})(e)}function n(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=t(r);if(n&&n.has(e))return n.get(e);var i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var a=o?Object.getOwnPropertyDescriptor(e,u):null;a&&(a.get||a.set)?Object.defineProperty(i,u,a):i[u]=e[u]}return i.default=e,n&&n.set(e,i),i}let i=void 0,o=void 0;const u=16;async function a(t,n){null==i&&(i=e.device.createComputePipeline({compute:{module:r.New(await(await fetch("compute/triangulate.wgsl")).text()),entryPoint:"main"}}));const o=e.CreateEmptyBuffer(4*n*u,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC),a=e.device.createCommandEncoder(),f=new Uint32Array([n]),s=e.CreateBuffer(f,GPUBufferUsage.STORAGE),c=e.device.createBindGroup({layout:i.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:s}},{binding:1,resource:{buffer:t}},{binding:2,resource:{buffer:o}}]}),d=a.beginComputePass();return d.setPipeline(i),d.setBindGroup(0,c),d.dispatch(Math.ceil(n/256)),d.endPass(),e.device.queue.submit([a.finish()]),o}async function f(t,n,i,u,a,f){if(null==o){const t=await(await fetch("render/triangle.wgsl")).text(),n=r.New(t);o=e.device.createRenderPipeline({vertex:{module:n,entryPoint:"vertexMain",buffers:[]},fragment:{module:n,entryPoint:"fragmentMain",targets:[{format:e.format}]},depthStencil:{format:"depth32float",depthWriteEnabled:!0,depthCompare:"less"},primitive:{topology:"triangle-list"}})}const s=new Float32Array(17);t.Save(s,0),new Uint32Array(s.buffer)[16]=a;const c=e.CreateBuffer(s,GPUBufferUsage.UNIFORM);e.renderPass.setPipeline(o);const d=e.device.createBindGroup({layout:o.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:e.cameraBuffer}},{binding:1,resource:{buffer:c}},{binding:2,resource:{buffer:n}},{binding:3,resource:{buffer:i}},{binding:4,resource:{buffer:u}}]});e.renderPass.setBindGroup(0,d),e.renderPass.draw(f*a*3)}exports.K=u;
},{"./gpu":"H5gw","./module":"khj6"}],"FjtV":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Compute=u;var e=n(require("./gpu")),t=n(require("./module"));function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}function n(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=r(t);if(n&&n.has(e))return n.get(e);var i={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=u?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(i,o,a):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}let i=void 0;async function u(r,n,u){null==i&&(i=e.device.createComputePipeline({compute:{module:t.New(await(await fetch("compute/filter.wgsl")).text()),entryPoint:"main"}}));const o=new Uint32Array([u,n]),a=e.CreateBuffer(o,GPUBufferUsage.STORAGE),c=e.device.createBindGroup({layout:i.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:a}},{binding:1,resource:{buffer:r}}]}),f=e.device.createCommandEncoder(),p=f.beginComputePass({});p.setPipeline(i),p.setBindGroup(0,c),p.dispatch(Math.ceil(u/256)),p.endPass(),e.device.queue.submit([f.finish()])}
},{"./gpu":"H5gw","./module":"khj6"}],"cFeU":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Compute=u;var e=n(require("./gpu")),t=n(require("./module"));function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}function n(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=r(t);if(n&&n.has(e))return n.get(e);var i={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=u?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(i,o,a):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}let i=void 0;async function u(r,n,u,o,a){null==i&&(i=e.device.createComputePipeline({compute:{module:t.New(await(await fetch("compute/edge.wgsl")).text()),entryPoint:"main"}}));const c=new Uint32Array([a,o]),f=e.CreateBuffer(c,GPUBufferUsage.STORAGE),p=e.device.createBindGroup({layout:i.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:f}},{binding:1,resource:{buffer:r}},{binding:2,resource:{buffer:n}},{binding:3,resource:{buffer:u}}]}),s=e.device.createCommandEncoder(),d=s.beginComputePass({});d.setPipeline(i),d.setBindGroup(0,p),d.dispatch(Math.ceil(a/256)),d.endPass(),e.device.queue.submit([s.finish()])}
},{"./gpu":"H5gw","./module":"khj6"}],"pGyK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Compute=u;var e=n(require("./gpu")),t=n(require("./module"));function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}function n(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=r(t);if(n&&n.has(e))return n.get(e);var i={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=u?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(i,o,a):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}let i=void 0;async function u(r,n,u,o,a){null==i&&(i=e.device.createComputePipeline({compute:{module:t.New(await(await fetch("compute/edgeOld.wgsl")).text()),entryPoint:"main"}}));const c=new Uint32Array([a,o]),f=e.CreateBuffer(c,GPUBufferUsage.STORAGE),p=e.device.createBindGroup({layout:i.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:f}},{binding:1,resource:{buffer:r}},{binding:2,resource:{buffer:n}},{binding:3,resource:{buffer:u}}]}),s=e.device.createCommandEncoder(),d=s.beginComputePass({});d.setPipeline(i),d.setBindGroup(0,p),d.dispatch(Math.ceil(a/256)),d.endPass(),e.device.queue.submit([s.finish()])}
},{"./gpu":"H5gw","./module":"khj6"}],"l7rz":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CreateColors=n;var e=t(require("../gpu/gpu"));function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}function t(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=r(t);if(n&&n.has(e))return n.get(e);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var f=a?Object.getOwnPropertyDescriptor(e,u):null;f&&(f.get||f.set)?Object.defineProperty(o,u,f):o[u]=e[u]}return o.default=e,n&&n.set(e,o),o}function n(r){const t=new Float32Array(4*r);for(let e=0;e<r;e++)t[4*e+0]=.3+.7*Math.random(),t[4*e+1]=.3+.7*Math.random(),t[4*e+2]=.3+.7*Math.random();return e.CreateBuffer(t,GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE)}
},{"../gpu/gpu":"H5gw"}],"sU9e":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CreateGrid=n;var e=t(require("../gpu/gpu"));function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}function t(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=r(t);if(n&&n.has(e))return n.get(e);var f={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var y=u?Object.getOwnPropertyDescriptor(e,o):null;y&&(y.get||y.set)?Object.defineProperty(f,o,y):f[o]=e[o]}return f.default=e,n&&n.set(e,f),f}function n(r){const t=new Float32Array(8*(4*r+3)),n=new Float32Array(8*(4*r+3)),f=(e,r,f,u,o)=>{null==o&&(o=u),t[(e*=8)+0]=r.x,t[e+1]=r.y,t[e+2]=r.z,n[e+0]=u.x,n[e+1]=u.y,n[e+2]=u.z,t[e+4]=f.x,t[e+5]=f.y,t[e+6]=f.z,n[e+4]=o.x,n[e+5]=o.y,n[e+6]=o.z};for(let e=-r;e<=r;e++){if(0==e)continue;let t;if(e<0)t=e;else{if(0==e)continue;t=e-1}f(1*r+t,{x:e,y:0,z:r},{x:e,y:0,z:-r},{x:1,y:1,z:1}),f(3*r+t,{x:r,y:0,z:e},{x:-r,y:0,z:e},{x:1,y:1,z:1})}return f(4*r+0,{x:-r,y:0,z:0},{x:r,y:0,z:0},{x:1,y:1,z:1},{x:1,y:0,z:0}),f(4*r+1,{x:0,y:-r,z:0},{x:0,y:r,z:0},{x:1,y:1,z:1},{x:0,y:1,z:0}),f(4*r+2,{x:0,y:0,z:-r},{x:0,y:0,z:r},{x:1,y:1,z:1},{x:0,y:0,z:1}),{length:2*(4*r+3),positions:e.CreateBuffer(t,GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE),colors:e.CreateBuffer(n,GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE)}}
},{"../gpu/gpu":"H5gw"}],"DUqp":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CreateSphere=n;var e=r(require("../gpu/gpu"));function t(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,n=new WeakMap;return(t=function(e){return e?n:r})(e)}function r(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=t(r);if(n&&n.has(e))return n.get(e);var a={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var f=o?Object.getOwnPropertyDescriptor(e,u):null;f&&(f.get||f.set)?Object.defineProperty(a,u,f):a[u]=e[u]}return a.default=e,n&&n.set(e,a),a}function n(t){const r=new Float32Array(4*t);for(let e=0;e<t;e++){const t=Math.acos(2*Math.random()-1),n=2*Math.random()*Math.PI;r[4*e+0]=Math.sin(n)*Math.sin(t),r[4*e+1]=Math.cos(t),r[4*e+2]=Math.cos(n)*Math.sin(t)}return e.CreateBuffer(r,GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE)}
},{"../gpu/gpu":"H5gw"}],"MLh6":[function(require,module,exports) {
"use strict";function r(r,e){const o=r.length,t=new Uint8Array(e);let n=0,i=0;do{let d=r[n++];if(d<32){if(i+ ++d>e)throw new Error("Output buffer is not large enough");if(n+d>o)throw new Error("Invalid compressed data");do{t[i++]=r[n++]}while(--d)}else{let a=d>>5,s=i-((31&d)<<8)-1;if(n>=o)throw new Error("Invalid compressed data");if(7===a&&(a+=r[n++],n>=o))throw new Error("Invalid compressed data");if(s-=r[n++],i+a+2>e)throw new Error("Output buffer is not large enough");if(s<0)throw new Error("Invalid compressed data");if(s>=i)throw new Error("Invalid compressed data");do{t[i++]=t[s++]}while(2+--a)}}while(n<o);return t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.LZF=r;
},{}],"KHL4":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CreatePCD=o;var e=n(require("./decompress")),t=n(require("../gpu/gpu"));function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}function n(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=r(t);if(n&&n.has(e))return n.get(e);var i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var a=o?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(i,s,a):i[s]=e[s]}return i.default=e,n&&n.set(e,i),i}const i=!0;function o(r){const n=s(r);if(null==n)return;const o=n.offset;let a=void 0;void 0!==o.x&&void 0!==o.y&&void 0!==o.z&&(a=new Float32Array(4*n.points));let l=void 0,f=void 0;if(void 0===o.rgb&&void 0===o.rgba||(l=new Float32Array(4*n.points),f=void 0===o.rgb?o.rgba:o.rgb),"ascii"===n.data){const e=new Uint8Array(r);let t="";for(let o=n.headerLen;o<r.byteLength;o++)t+=String.fromCharCode(e[o]);const i=t.split("\n");let s=0;for(let r=0;r<i.length;r++,s+=4){const e=i[r].split(" ");if(void 0!==a&&(a[s+0]=parseFloat(e[o.x]),a[s+1]=parseFloat(e[o.y]),a[s+2]=parseFloat(e[o.z])),void 0!==l){let t=void 0;void 0!==o.rgba?t=new Uint32Array([parseInt(e[o.rgba])]):void 0!==o.rgb&&(t=new Float32Array([parseFloat(e[o.rgb])]));const r=new Uint8Array(t.buffer,0);l[s+2]=r[0]/255,l[s+1]=r[1]/255,l[s+0]=r[2]/255}}}else if("binary"===n.data){let e=0;const t=new DataView(r,n.headerLen);for(let r=0;r<n.points;e+=n.rowSize,r++)void 0!==a&&(a[4*r+0]=t.getFloat32(e+o.x,i),a[4*r+1]=t.getFloat32(e+o.y,i),a[4*r+2]=t.getFloat32(e+o.z,i)),void 0!==l&&(l[4*r+2]=t.getUint8(e+f+0)/255,l[4*r+1]=t.getUint8(e+f+1)/255,l[4*r+0]=t.getUint8(e+f+2)/255)}else if("binary_compressed"===n.data){const t=new Uint32Array(r.slice(n.headerLen,n.headerLen+8)),s=t[0],c=t[1],u=e.LZF(new Uint8Array(r,n.headerLen+8,s),c),p=new DataView(u.buffer);for(let e=0;e<n.points;e++)void 0!==a&&(a[4*e+0]=p.getFloat32(o.x+4*e,i),a[4*e+1]=p.getFloat32(o.y+4*e,i),a[4*e+2]=p.getFloat32(o.z+4*e,i)),void 0!==l&&(l[4*e+2]=p.getUint8(f+4*e+0)/255,l[4*e+1]=p.getUint8(f+4*e+1)/255,l[4*e+0]=p.getUint8(f+4*e+2)/255)}return null!=a?[t.CreateBuffer(a,GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE),n.points]:void 0}function s(e){let t="";const r=new Uint8Array(e);let n=0;const i=r.length;for(;n<i&&-1===t.search(/[\r\n]DATA\s(\S*)\s/i);)t+=String.fromCharCode(r[n++]);const o=t.search(/[\r\n]DATA\s(\S*)\s/i),s=/[\r\n]DATA\s(\S*)\s/i.exec(t.substr(o-1));if(null==o||null==s)return null;const a={};a.data=s[1],a.headerLen=s[0].length+o,a.str=t.substr(0,a.headerLen),a.str=a.str.replace(/#.*/gi,"");const l=/VERSION (.*)/i.exec(a.str);null!==l&&(a.version=parseFloat(l[1]));const f=/FIELDS (.*)/i.exec(a.str);null!==f&&(a.fields=f[1].split(" "));const c=/SIZE (.*)/i.exec(a.str);null!==c&&(a.size=c[1].split(" ").map(function(e){return parseInt(e,10)}));const u=/TYPE (.*)/i.exec(a.str);null!==u&&(a.type=u[1].split(" "));const p=/COUNT (.*)/i.exec(a.str);null!==p&&(a.count=p[1].split(" ").map(function(e){return parseInt(e,10)}));const d=/WIDTH (.*)/i.exec(a.str);null!==d&&(a.width=parseInt(d[1]));const g=/HEIGHT (.*)/i.exec(a.str);null!==g&&(a.height=parseInt(g[1]));const y=/VIEWPOINT (.*)/i.exec(a.str);null!==y&&(a.viewpoint=y[1]);const v=/POINTS (.*)/i.exec(a.str);if(null!==v&&(a.points=parseInt(v[1],10)),null===a.points&&(a.points=a.width*a.height),null==a.count)for(a.count=[],n=0;n<a.fields.length;n++)a.count.push(1);a.offset={};let h=0;for(let b=0;b<a.fields.length;b++)"ascii"===a.data?a.offset[a.fields[b]]=b:"binary"===a.data?(a.offset[a.fields[b]]=h,h+=a.size[b]):"binary_compressed"===a.data&&(a.offset[a.fields[b]]=h,h+=a.size[b]*a.points);return a.rowSize=h,a}
},{"./decompress":"MLh6","../gpu/gpu":"H5gw"}],"ZCfc":[function(require,module,exports) {
"use strict";var e=h(require("./gpu/gpu")),t=h(require("./gpu/lines")),r=require("./gpu/position"),n=require("./gpu/camera"),a=require("./loader/cube"),o=h(require("./gpu/cloud")),i=h(require("./gpu/kNearest")),l=h(require("./gpu/triangulate")),c=h(require("./gpu/filter")),s=h(require("./gpu/edge")),u=h(require("./gpu/edgeOld")),d=require("./loader/color"),p=require("./loader/grid"),m=require("./loader/sphere"),f=require("./loader/pcd");function w(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(w=function(e){return e?r:t})(e)}function h(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=w(t);if(r&&r.has(e))return r.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var i=a?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(n,o,i):n[o]=e[o]}return n.default=e,r&&r.set(e,n),n}function g(...e){const t=document.createElement("div");let r="";for(let n=0;n<e.length;n++)r+=e[n]+"\n";t.textContent=r,t.className="hint",document.body.append(t),setTimeout(()=>{t.remove()},5e3)}function b(e){const t=prompt(e);if(null==t)return;const r=parseInt(t);return isNaN(r)?void 0:r}document.body.onload=(async()=>{const w=document.getElementById("display"),h=await e.Setup(w.clientWidth,w.clientHeight);if(null==h){w.remove();const e=document.createElement("div");e.className="error";const t=document.createElement("div");t.className="large",t.innerHTML="WebGPU not available",e.append(t);const r=document.createElement("div");return r.className="normal",r.innerHTML='Only tested with <a href="https://www.google.com/chrome">Google Chrome</a>',e.append(r),void document.body.append(e)}w.append(h);const y=new n.Camera(Math.PI/4);y.Translate(0,5,30);const C=new r.Position;C.Scale(5,5,5);const k=new r.Position;let v=64,P=v,q=5e4,M=q,D="sphere",K=(0,m.CreateSphere)(q),O=(0,d.CreateColors)(q);const R=(0,p.CreateGrid)(10);w.onwheel=(e=>{const t=1+e.deltaY/1e3;if(0==e.ctrlKey)C.Scale(t,t,t);else{let e=y.fieldOfView*t;e<Math.PI/10&&(e=Math.PI/10),e>9*Math.PI/10&&(e=9*Math.PI/10),y.fieldOfView=e}e.preventDefault(),e.stopImmediatePropagation()}),document.body.onresize=(()=>{e.Resize(w.clientWidth,w.clientHeight),y.UpdateSize()});const S={};let I=void 0;document.body.onkeydown=(async e=>{switch(S[e.code]=!0,e.code){case"KeyH":g("Left mouse button: rotate camera","Mouse wheel: change cloud size","Mouse wheel + Control: change field of view","QWER: move camera","1: change cloud form","1 + Control: change cloud size for sphere and cube","2: compute k nearest points","2 + Control: change k","3: compute triangulation","4: approximate normal (best with triangulation)","4 + Control: approximate normal (best with k-nearest)","Space: render connections with polygons","0: open notes (german)");break;case"Digit1":if(e.ctrlKey){const e=b("input new cloud size");if(null==e)break;M=e,D="test"}switch(K.destroy(),O.destroy(),D){case"sphere":q=M,K=(0,a.CreateCube)(q),D="cube";break;case"cube":{const e=await fetch("pcd/bunny.pcd"),t=await(await e.blob()).arrayBuffer(),r=(0,f.CreatePCD)(t);null!=r?[K,q]=r:alert("pcd error"),D="bunny";break}case"bunny":{const e=await fetch("pcd/rops_cloud.pcd"),t=await(await e.blob()).arrayBuffer(),r=(0,f.CreatePCD)(t);null!=r?[K,q]=r:alert("pcd error"),D="test";break}case"test":q=M,K=(0,m.CreateSphere)(q),D="sphere"}O=(0,d.CreateColors)(q),null!=I&&(I.destroy(),I=void 0);break;case"Digit2":if(e.ctrlKey){const e=b("input new k for nearest points");null!=e&&(P=e)}null!=I&&I.destroy(),v=P,I=await i.Compute(v,K,q);break;case"Digit3":null!=I&&I.destroy(),I=await l.Compute(K,q),v=l.K;break;case"Digit4":if(null==I){alert("please calculate the connections first");break}0==e.ctrlKey?await s.Compute(K,I,O,v,q):await u.Compute(K,I,O,v,q);break;case"Digit5":if(null==I){alert("please calculate the connections first");break}await c.Compute(I,v,q);break;case"Digit0":window.open("notes.html","_blank")}}),document.body.onkeyup=(e=>{delete S[e.code]}),g("press 'H' for help"),w.onmousemove=(e=>{0!=(1&e.buttons)&&(y.RotateX(-e.movementY/200),y.RotateGlobalY(-e.movementX/200))});let W=await new Promise(requestAnimationFrame);for(;;){const r=await new Promise(requestAnimationFrame),n=r-W;n>25&&console.log(n);const a=n/50,c=(e,t,r,n)=>{null!=S[e]&&y.Translate(t*a,r*a,n*a)};c("KeyW",0,0,-1),c("KeyD",1,0,0),c("KeyS",0,0,1),c("KeyA",-1,0,0),c("KeyF",0,-1,0),c("KeyR",0,1,0),e.StartRender(y),await t.Render(k,R.length,R.positions,R.colors),null!=I?null==S.Space?(await o.Render(C,.015,q,K,O),await i.Render(C,K,O,I,v,q)):await l.Render(C,K,O,I,v,q):await o.Render(C,.015,q,K,O),e.FinishRender(),W=r}});
},{"./gpu/gpu":"H5gw","./gpu/lines":"TmaS","./gpu/position":"wYMo","./gpu/camera":"Nat1","./loader/cube":"dsRi","./gpu/cloud":"VW9R","./gpu/kNearest":"jToc","./gpu/triangulate":"i6k6","./gpu/filter":"FjtV","./gpu/edge":"cFeU","./gpu/edgeOld":"pGyK","./loader/color":"l7rz","./loader/grid":"sU9e","./loader/sphere":"DUqp","./loader/pcd":"KHL4"}]},{},["ZCfc"], null)
//# sourceMappingURL=main.4f27248a.js.map